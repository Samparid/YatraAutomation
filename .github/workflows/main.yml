name: Yatra Automation
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Java 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'

      - name: Set up Chrome
        uses: browser-actions/setup-chrome@v1

      - name: Install dependencies (Xvfb + Chrome runtime libs)
        run: |
          sudo apt-get update
          sudo apt-get install -y xvfb libxi6 libxss1 libnss3 libatk1.0-0 libatk-bridge2.0-0 libcups2 libxrandr2 libasound2 libpangocairo-1.0-0 fonts-liberation

      - name: Start Xvfb and set DISPLAY
        run: |
          Xvfb :99 -screen 0 1920x1080x24 >/dev/null 2>&1 &
          echo "DISPLAY=:99" >> $GITHUB_ENV

      - name: Compile Java sources
        run: |
          mkdir -p out
          # compile all Java sources from src/main/java, include libs in classpath if present
          SRC_FILES=$(find src/main/java -name "*.java" || true)
          if [ -n "$SRC_FILES" ]; then
            javac -cp "libs/*:." -d out $SRC_FILES
          else
            echo "No Java source files found in src/main/java"
          fi

      - name: Run automation script
        run: |
          # Adjust the main class below if your package/class name differs
          java -cp "out:libs/*:." com.yatra.automation.YatraAutomationScript
